<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ad Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>📊</text></svg>">
    <style>
        .glassmorphism {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        .sidebar-item.active {
            background: rgba(255, 255, 255, 0.2);
            border-left: 3px solid rgba(14, 165, 233, 0.8);
        }
        .notification-card {
            transition: all 0.3s ease;
        }
        .chart-container {
            height: 300px;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen font-sans text-gray-800">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <div class="glassmorphism w-64 flex-shrink-0 hidden md:flex flex-col border-r border-gray-200">
            <div class="p-4 flex items-center space-x-3">
                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center text-white">
                    <i class="fas fa-ad text-lg"></i>
                </div>
                <h1 class="text-xl font-bold text-gray-800">Ad Monitor</h1>
            </div>
            <nav class="flex-1 px-2 py-4 space-y-1">
                <a href="#" id="dashboard-link" class="sidebar-item active flex items-center px-4 py-3 text-sm font-medium rounded-md transition">
                    <i class="fas fa-tachometer-alt mr-3 text-gray-600"></i>
                    Dashboard
                </a>
                <a href="#" id="add-page-link" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium rounded-md transition">
                    <i class="fas fa-plus-circle mr-3 text-gray-600"></i>
                    Add Page
                </a>
                <a href="#" id="add-ad-link" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium rounded-md transition">
                    <i class="fas fa-ad mr-3 text-gray-600"></i>
                    Add Ad
                </a>
                <a href="#" id="notifications-link" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium rounded-md transition">
                    <i class="fas fa-bell mr-3 text-gray-600"></i>
                    Notifications
                    <span id="notification-badge" class="ml-auto bg-red-500 text-white text-xs px-2 py-1 rounded-full hidden">0</span>
                </a>
            </nav>
        </div>

        <!-- Mobile sidebar toggle -->
        <div class="md:hidden fixed bottom-4 right-4 z-50">
            <button id="mobile-menu-button" class="p-3 rounded-full bg-blue-600 text-white shadow-lg">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <!-- Mobile sidebar -->
        <div id="mobile-sidebar" class="glassmorphism fixed inset-0 z-40 transform -translate-x-full md:hidden transition-transform duration-300">
            <div class="flex flex-col h-full">
                <div class="p-4 flex items-center justify-between border-b border-gray-200">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center text-white">
                            <i class="fas fa-ad text-lg"></i>
                        </div>
                        <h1 class="text-xl font-bold text-gray-800">Ad Monitor</h1>
                    </div>
                    <button id="close-mobile-menu" class="p-2 rounded-full hover:bg-gray-100">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <nav class="flex-1 px-2 py-4 space-y-1">
                    <a href="#" id="mobile-dashboard-link" class="sidebar-item active flex items-center px-4 py-3 text-sm font-medium rounded-md transition">
                        <i class="fas fa-tachometer-alt mr-3 text-gray-600"></i>
                        Dashboard
                    </a>
                    <a href="#" id="mobile-add-page-link" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium rounded-md transition">
                        <i class="fas fa-plus-circle mr-3 text-gray-600"></i>
                        Add Page
                    </a>
                    <a href="#" id="mobile-add-ad-link" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium rounded-md transition">
                        <i class="fas fa-ad mr-3 text-gray-600"></i>
                        Add Ad
                    </a>
                    <a href="#" id="mobile-notifications-link" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium rounded-md transition">
                        <i class="fas fa-bell mr-3 text-gray-600"></i>
                        Notifications
                        <span id="mobile-notification-badge" class="ml-auto bg-red-500 text-white text-xs px-2 py-1 rounded-full hidden">0</span>
                    </a>
                </nav>
            </div>
        </div>

        <!-- Main content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Top navigation -->
            <header class="glassmorphism border-b border-gray-200">
                <div class="flex items-center justify-between px-6 py-4">
                    <h2 id="page-title" class="text-xl font-semibold text-gray-800">Dashboard</h2>
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <button id="notification-button" class="p-2 rounded-full hover:bg-gray-100 relative">
                                <i class="fas fa-bell text-gray-600"></i>
                                <span id="header-notification-badge" class="absolute top-0 right-0 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center hidden">0</span>
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Main content area -->
            <main class="flex-1 overflow-y-auto p-6 bg-gray-50">
                <!-- Dashboard Section -->
                <section id="dashboard-section" class="space-y-6 animate-fade-in">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Total Pages Card -->
                        <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-500">Total Pages</p>
                                    <h3 id="total-pages" class="text-3xl font-bold mt-2">0</h3>
                                </div>
                                <div class="p-3 rounded-lg bg-blue-50 text-blue-600">
                                    <i class="fas fa-file-alt text-xl"></i>
                                </div>
                            </div>
                            <div class="mt-4">
                                <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
                                    <div class="h-full bg-gradient-to-r from-blue-400 to-blue-600 rounded-full" style="width: 100%"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Active Ads Card -->
                        <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-500">Active Ads</p>
                                    <h3 id="active-ads" class="text-3xl font-bold mt-2">0</h3>
                                </div>
                                <div class="p-3 rounded-lg bg-green-50 text-green-600">
                                    <i class="fas fa-check-circle text-xl"></i>
                                </div>
                            </div>
                            <div class="mt-4">
                                <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
                                    <div class="h-full bg-gradient-to-r from-green-400 to-green-600 rounded-full" style="width: 75%"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Deleted Ads Card -->
                        <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-500">Deleted Ads</p>
                                    <h3 id="deleted-ads" class="text-3xl font-bold mt-2">0</h3>
                                </div>
                                <div class="p-3 rounded-lg bg-red-50 text-red-600">
                                    <i class="fas fa-trash-alt text-xl"></i>
                                </div>
                            </div>
                            <div class="mt-4">
                                <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
                                    <div class="h-full bg-gradient-to-r from-red-400 to-red-600 rounded-full" style="width: 25%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Chart Section -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-semibold text-gray-800">Ads Distribution</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="adsChart"></canvas>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-semibold text-gray-800">Recent Notifications</h3>
                                <button id="refresh-notifications" class="p-2 rounded-full hover:bg-gray-100">
                                    <i class="fas fa-sync-alt text-gray-600"></i>
                                </button>
                            </div>
                            <div id="recent-notifications" class="space-y-3 max-h-64 overflow-y-auto">
                                <div class="text-center py-8 text-gray-500">
                                    <i class="fas fa-bell-slash text-3xl mb-3"></i>
                                    <p>No recent notifications</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Add Page Section -->
                <section id="add-page-section" class="hidden space-y-6">
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100 animate-fade-in">
                        <h3 class="text-lg font-semibold text-gray-800 mb-6">Add New Page</h3>
                        <form id="add-page-form" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="page-date" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                                    <input type="date" id="page-date" name="Date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                                </div>
                                <div>
                                    <label for="page-name" class="block text-sm font-medium text-gray-700 mb-1">Page Name *</label>
                                    <input type="text" id="page-name" name="Page_Name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                                </div>
                                <div>
                                    <label for="page-link" class="block text-sm font-medium text-gray-700 mb-1">Page Link *</label>
                                    <input type="url" id="page-link" name="Page_Link" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                                </div>
                                <div>
                                    <label for="website" class="block text-sm font-medium text-gray-700 mb-1">Website (Optional)</label>
                                    <input type="url" id="website" name="Website" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                                </div>
                            </div>
                            <div class="pt-4">
                                <button type="submit" class="px-6 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition flex items-center space-x-2">
                                    <span>Add Page</span>
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                </section>

                <!-- Add Ad Section -->
                <section id="add-ad-section" class="hidden space-y-6">
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100 animate-fade-in">
                        <h3 class="text-lg font-semibold text-gray-800 mb-6">Create New Ad</h3>
                        <form id="add-ad-form" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="ad-date" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                                    <input type="date" id="ad-date" name="Date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                                </div>
                                <div>
                                    <label for="page-name-dropdown" class="block text-sm font-medium text-gray-700 mb-1">Page Name *</label>
                                    <select id="page-name-dropdown" name="Page_Name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                                        <option value="">Loading pages...</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="product-name" class="block text-sm font-medium text-gray-700 mb-1">Product Name *</label>
                                    <input type="text" id="product-name" name="Product_Name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                                </div>
                                <div>
                                    <label for="ad-link" class="block text-sm font-medium text-gray-700 mb-1">Ad Link *</label>
                                    <input type="url" id="ad-link" name="Ad_Link" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                                </div>
                                <div>
                                    <label for="product-link" class="block text-sm font-medium text-gray-700 mb-1">Product Link (Optional)</label>
                                    <input type="url" id="product-link" name="Product_Link" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                                </div>
                                <div class="flex items-end">
                                    <div class="w-full">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                        <div class="px-4 py-2 bg-green-100 text-green-800 rounded-lg inline-flex items-center">
                                            <i class="fas fa-check-circle mr-2"></i>
                                            <span>✅ ACTIVE</span>
                                        </div>
                                        <input type="hidden" name="Status" value="✅ ACTIVE">
                                    </div>
                                </div>
                            </div>
                            <div class="pt-4">
                                <button type="submit" class="px-6 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition flex items-center space-x-2">
                                    <span>Create Ad</span>
                                    <i class="fas fa-ad"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                </section>

                <!-- Notifications Section -->
                <section id="notifications-section" class="hidden space-y-6">
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100 animate-fade-in">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold text-gray-800">Notifications</h3>
                            <button id="mark-all-read" class="px-4 py-2 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition">
                                Refresh
                            </button>
                        </div>
                        <div id="notifications-list" class="space-y-3">
                            <div class="text-center py-8 text-gray-500">
                                <i class="fas fa-bell-slash text-3xl mb-3"></i>
                                <p>No notifications yet</p>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="success-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden">
        <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4 transform transition-all animate-fade-in">
            <div class="text-center">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-check text-green-600 text-2xl"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-800 mb-2" id="success-title">Success!</h3>
                <p class="text-gray-600 mb-6" id="success-message">Your data has been successfully submitted.</p>
                <button id="close-success-modal" class="px-6 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Error Modal -->
    <div id="error-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden">
        <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4 transform transition-all animate-fade-in">
            <div class="text-center">
                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-exclamation-triangle text-red-600 text-2xl"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-800 mb-2" id="error-title">Error!</h3>
                <p class="text-gray-600 mb-6" id="error-message">There was an error processing your request.</p>
                <button id="close-error-modal" class="px-6 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loading-spinner" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-30 hidden">
        <div class="bg-white p-6 rounded-xl shadow-lg flex items-center space-x-4">
            <div class="w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
            <span class="text-gray-800">Processing...</span>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Configuration
            const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxqQmO32xF2UZiogY0Qqujv1wtqfMNxcYEmXgH_7SNZlQtQ-b2jpLuWnd6ZEBMFtQPlPw/exec'; // Replace with your deployed web app URL
            
            // UI Elements
            const sections = {
                dashboard: document.getElementById('dashboard-section'),
                addPage: document.getElementById('add-page-section'),
                addAd: document.getElementById('add-ad-section'),
                notifications: document.getElementById('notifications-section')
            };
            
            const links = {
                dashboard: document.getElementById('dashboard-link'),
                addPage: document.getElementById('add-page-link'),
                addAd: document.getElementById('add-ad-link'),
                notifications: document.getElementById('notifications-link'),
                mobileDashboard: document.getElementById('mobile-dashboard-link'),
                mobileAddPage: document.getElementById('mobile-add-page-link'),
                mobileAddAd: document.getElementById('mobile-add-ad-link'),
                mobileNotifications: document.getElementById('mobile-notifications-link')
            };
            
            const pageTitle = document.getElementById('page-title');
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileSidebar = document.getElementById('mobile-sidebar');
            const closeMobileMenu = document.getElementById('close-mobile-menu');
            const notificationButton = document.getElementById('notification-button');
            const refreshNotifications = document.getElementById('refresh-notifications');
            const markAllRead = document.getElementById('mark-all-read');
            const successModal = document.getElementById('success-modal');
            const closeSuccessModal = document.getElementById('close-success-modal');
            const errorModal = document.getElementById('error-modal');
            const closeErrorModal = document.getElementById('close-error-modal');
            const loadingSpinner = document.getElementById('loading-spinner');
            
            // Forms
            const addPageForm = document.getElementById('add-page-form');
            const addAdForm = document.getElementById('add-ad-form');
            
            // Chart
            let adsChart;
            
            // Set current date as default in date fields
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('page-date').value = today;
            document.getElementById('ad-date').value = today;
            
            // Navigation functions
            function showSection(section) {
                // Hide all sections
                Object.values(sections).forEach(sec => sec.classList.add('hidden'));
                
                // Show selected section
                sections[section].classList.remove('hidden');
                
                // Update page title
                const titles = {
                    dashboard: 'Dashboard',
                    addPage: 'Add Page',
                    addAd: 'Add Ad',
                    notifications: 'Notifications'
                };
                pageTitle.textContent = titles[section];
                
                // Update active link
                Object.values(links).forEach(link => {
                    link.classList.remove('active');
                    link.classList.add('sidebar-item');
                });
                
                links[section].classList.add('active');
                links[section].classList.remove('sidebar-item');
                
                // For mobile links
                if (section === 'dashboard') {
                    links.mobileDashboard.classList.add('active');
                    links.mobileDashboard.classList.remove('sidebar-item');
                } else if (section === 'addPage') {
                    links.mobileAddPage.classList.add('active');
                    links.mobileAddPage.classList.remove('sidebar-item');
                } else if (section === 'addAd') {
                    links.mobileAddAd.classList.add('active');
                    links.mobileAddAd.classList.remove('sidebar-item');
                    loadPageNames();
                } else if (section === 'notifications') {
                    links.mobileNotifications.classList.add('active');
                    links.mobileNotifications.classList.remove('sidebar-item');
                    loadNotifications();
                }
                
                // Close mobile menu if open
                mobileSidebar.classList.add('-translate-x-full');
                
                // Load data if needed
                if (section === 'dashboard') {
                    loadDashboardData();
                }
            }
            
            // Navigation event listeners
            links.dashboard.addEventListener('click', (e) => {
                e.preventDefault();
                showSection('dashboard');
            });
            
            links.addPage.addEventListener('click', (e) => {
                e.preventDefault();
                showSection('addPage');
            });
            
            links.addAd.addEventListener('click', (e) => {
                e.preventDefault();
                showSection('addAd');
            });
            
            links.notifications.addEventListener('click', (e) => {
                e.preventDefault();
                showSection('notifications');
            });
            
            // Mobile navigation
            links.mobileDashboard.addEventListener('click', (e) => {
                e.preventDefault();
                showSection('dashboard');
            });
            
            links.mobileAddPage.addEventListener('click', (e) => {
                e.preventDefault();
                showSection('addPage');
            });
            
            links.mobileAddAd.addEventListener('click', (e) => {
                e.preventDefault();
                showSection('addAd');
            });
            
            links.mobileNotifications.addEventListener('click', (e) => {
                e.preventDefault();
                showSection('notifications');
            });
            
            // Mobile menu toggle
            mobileMenuButton.addEventListener('click', () => {
                mobileSidebar.classList.remove('-translate-x-full');
            });
            
            closeMobileMenu.addEventListener('click', () => {
                mobileSidebar.classList.add('-translate-x-full');
            });
            
            notificationButton.addEventListener('click', (e) => {
                e.preventDefault();
                showSection('notifications');
            });
            
            refreshNotifications.addEventListener('click', (e) => {
                e.preventDefault();
                loadNotifications();
            });
            
            markAllRead.addEventListener('click', () => {
                loadNotifications();
            });
            
            closeSuccessModal.addEventListener('click', () => {
                successModal.classList.add('hidden');
            });
            
            closeErrorModal.addEventListener('click', () => {
                errorModal.classList.add('hidden');
            });
            
            // Form submissions
            addPageForm.addEventListener('submit', function(e) {
                e.preventDefault();
                submitForm('add-page-form', 'Pages');
            });
            
            addAdForm.addEventListener('submit', function(e) {
                e.preventDefault();
                submitForm('add-ad-form', 'Ads');
            });
            
            // Initialize dashboard
            showSection('dashboard');
            loadPageNames();
            
            // Functions
            async function loadDashboardData() {
                showLoading();
                
                try {
                    const response = await fetch(`${SCRIPT_URL}?action=getDashboardData`);
                    const data = await response.json();
                    
                    if (data.status === 'error') {
                        throw new Error(data.message);
                    }
                    
                    // Update stats
                    document.getElementById('total-pages').textContent = data.data.totalPages || '0';
                    document.getElementById('active-ads').textContent = data.data.activeAds || '0';
                    document.getElementById('deleted-ads').textContent = data.data.deletedAds || '0';
                    
                    // Update chart
                    updateChart(data.data.activeAds, data.data.deletedAds);
                    
                    // Load recent notifications
                    if (data.data.notifications && data.data.notifications.length > 0) {
                        loadRecentNotifications(data.data.notifications);
                    }
                    
                } catch (error) {
                    console.error('Error loading dashboard data:', error);
                    showError('Error', 'Failed to load dashboard data');
                } finally {
                    hideLoading();
                }
            }
            
            async function loadPageNames() {
                try {
                    const response = await fetch(`${SCRIPT_URL}?action=getPageNames`);
                    const data = await response.json();
                    
                    if (data.status === 'error') {
                        throw new Error(data.message);
                    }
                    
                    const dropdown = document.getElementById('page-name-dropdown');
                    dropdown.innerHTML = '<option value="">Select a page</option>';
                    
                    if (data.data && data.data.length > 0) {
                        data.data.forEach(page => {
                            const option = document.createElement('option');
                            option.value = page;
                            option.textContent = page;
                            dropdown.appendChild(option);
                        });
                    } else {
                        dropdown.innerHTML = '<option value="">No pages found</option>';
                    }
                } catch (error) {
                    console.error('Error loading page names:', error);
                    document.getElementById('page-name-dropdown').innerHTML = '<option value="">Error loading pages</option>';
                }
            }
            
            async function loadNotifications() {
                showLoading();
                
                try {
                    const response = await fetch(`${SCRIPT_URL}?action=getNotifications`);
                    const data = await response.json();
                    
                    if (data.status === 'error') {
                        throw new Error(data.message);
                    }
                    
                    const container = document.getElementById('notifications-list');
                    container.innerHTML = '';
                    
                    if (data.data && data.data.length > 0) {
                        data.data.forEach((notification, index) => {
                            const card = document.createElement('div');
                            card.className = `notification-card bg-white p-4 rounded-lg border border-gray-200 shadow-sm ${index < 3 ? 'unread border-l-4 border-l-blue-500' : ''}`;
                            
                            const icon = notification.includes('❌') ? '❌' : '🛎️';
                            const timeMatch = notification.match(/at (\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2})/);
                            const timestamp = timeMatch ? timeMatch[1] : 'Just now';
                            
                            card.innerHTML = `
                                <div class="flex items-start space-x-3">
                                    <div class="text-xl mt-1">${icon}</div>
                                    <div class="flex-1">
                                        <div class="flex justify-between items-start">
                                            <p class="font-medium text-gray-800">${notification.split(' at ')[0]}</p>
                                            <span class="text-xs text-gray-500">${timestamp}</span>
                                        </div>
                                    </div>
                                </div>
                            `;
                            
                            container.appendChild(card);
                        });
                        
                        updateNotificationBadge(data.data.filter(n => n.includes('❌')).length);
                    } else {
                        container.innerHTML = `
                            <div class="text-center py-8 text-gray-500">
                                <i class="fas fa-bell-slash text-3xl mb-3"></i>
                                <p>No notifications yet</p>
                            </div>
                        `;
                        updateNotificationBadge(0);
                    }
                    
                } catch (error) {
                    console.error('Error loading notifications:', error);
                    document.getElementById('notifications-list').innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-exclamation-triangle text-3xl mb-3"></i>
                            <p>Error loading notifications</p>
                        </div>
                    `;
                } finally {
                    hideLoading();
                }
            }
            
            function loadRecentNotifications(notifications) {
                const container = document.getElementById('recent-notifications');
                container.innerHTML = '';
                
                if (notifications && notifications.length > 0) {
                    notifications.slice(0, 3).forEach(notification => {
                        const card = document.createElement('div');
                        card.className = 'notification-card bg-white p-4 rounded-lg border border-gray-200 shadow-sm';
                        
                        const icon = notification.includes('❌') ? '❌' : '🛎️';
                        const timeMatch = notification.match(/at (\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2})/);
                        const timestamp = timeMatch ? timeMatch[1] : 'Just now';
                        
                        card.innerHTML = `
                            <div class="flex items-start space-x-3">
                                <div class="text-xl mt-1">${icon}</div>
                                <div class="flex-1">
                                    <div class="flex justify-between items-start">
                                        <p class="font-medium text-gray-800">${notification.split(' at ')[0]}</p>
                                        <span class="text-xs text-gray-500">${timestamp}</span>
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        container.appendChild(card);
                    });
                    
                    if (notifications.length > 3) {
                        const moreLink = document.createElement('a');
                        moreLink.href = '#';
                        moreLink.className = 'block text-center text-sm text-blue-600 hover:text-blue-800 mt-3';
                        moreLink.textContent = `View all ${notifications.length} notifications`;
                        moreLink.addEventListener('click', (e) => {
                            e.preventDefault();
                            showSection('notifications');
                        });
                        container.appendChild(moreLink);
                    }
                } else {
                    container.innerHTML = `
                        <div class="text-center py-4 text-gray-500">
                            <p>No recent notifications</p>
                        </div>
                    `;
                }
            }
            
            function updateChart(activeAds, deletedAds) {
                const ctx = document.getElementById('adsChart').getContext('2d');
                
                if (adsChart) {
                    adsChart.destroy();
                }
                
                adsChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Active Ads', 'Deleted Ads'],
                        datasets: [{
                            data: [activeAds || 0, deletedAds || 0],
                            backgroundColor: [
                                'rgba(16, 185, 129, 0.8)',
                                'rgba(239, 68, 68, 0.8)'
                            ],
                            borderColor: [
                                'rgba(16, 185, 129, 1)',
                                'rgba(239, 68, 68, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.raw || 0;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = Math.round((value / total) * 100);
                                        return `${label}: ${value} (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            async function submitForm(formId, sheetName) {
                const form = document.getElementById(formId);
                const formData = new FormData(form);
                const data = {};
                
                formData.forEach((value, key) => {
                    data[key] = value;
                });

                showLoading();
                
                try {
                    const response = await fetch(SCRIPT_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            sheetName: sheetName,
                            data: data
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.status === 'error') {
                        throw new Error(result.message);
                    }

                    showSuccess(
                        'Success!', 
                        formId === 'add-page-form' ? 'Page added successfully!' : 'Ad created successfully!'
                    );
                    
                    form.reset();
                    document.getElementById(`${formId === 'add-page-form' ? 'page' : 'ad'}-date`).value = today;
                    
                    // Reload dashboard data if on dashboard
                    if (document.getElementById('dashboard-section').classList.contains('hidden') === false) {
                        loadDashboardData();
                    }
                    
                    // Reload page names if adding a new page
                    if (formId === 'add-page-form') {
                        loadPageNames();
                    }
                    
                } catch (error) {
                    console.error('Submission Error:', error);
                    showError('Error', error.message || 'There was an error submitting your data');
                } finally {
                    hideLoading();
                }
            }
            
            function updateNotificationBadge(count) {
                const badges = [
                    document.getElementById('notification-badge'),
                    document.getElementById('mobile-notification-badge'),
                    document.getElementById('header-notification-badge')
                ];
                
                badges.forEach(badge => {
                    if (count > 0) {
                        badge.textContent = count;
                        badge.classList.remove('hidden');
                    } else {
                        badge.classList.add('hidden');
                    }
                });
            }
            
            function showSuccess(title, message) {
                document.getElementById('success-title').textContent = title;
                document.getElementById('success-message').textContent = message;
                successModal.classList.remove('hidden');
            }
            
            function showError(title, message) {
                document.getElementById('error-title').textContent = title;
                document.getElementById('error-message').textContent = message;
                errorModal.classList.remove('hidden');
            }
            
            function showLoading() {
                loadingSpinner.classList.remove('hidden');
            }
            
            function hideLoading() {
                loadingSpinner.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
